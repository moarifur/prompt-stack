# Complete Prisma with Neon Database Setup Guide

This guide walks you through setting up a PostgreSQL database with Neon, integrating Prisma ORM, and seeding your database in a Next.js project.

## Prerequisites

- Node.js installed
- A Neon account (free tier available)
- Basic knowledge of Next.js

## Step 1: Create a Neon Database

1. Go to [neon.tech](https://neon.tech) and sign in
2. You'll be redirected to the [Neon Console](https://console.neon.tech/app/projects)
3. Create a new project (e.g., "prompt-stack")
4. Copy your database connection URL

Example connection URL:
```
postgresql://neondb_owner:npg_4mOZnNL6PDAz@ep-tiny-pine-ado7gdy7-pooler.c-2.us-east-1.aws.neon.tech/neondb?sslmode=require&channel_binding=require
```

**⚠️ Security Note:** Never commit your database URL to version control. Always use environment variables.

## Step 2: Install Prisma

Install the required Prisma packages:

```bash
# Install Prisma CLI (for migrations, generation, etc.)
npm install prisma --save-dev

# Install Prisma Client (used by your app)
npm install @prisma/client
```

## Step 3: Initialize Prisma

Run the initialization command:

```bash
npx prisma init
```

This command will:
- Create a `prisma/schema.prisma` file
- Create a `.env` file with a placeholder `DATABASE_URL`

**Expected output:**
```
✔ Your Prisma schema was created at prisma/schema.prisma
  You can now open it in your favorite editor.

warn You already have a .gitignore file. Don't forget to add `.env` in it to not commit any private information.
```

## Step 4: Configure Environment Variables

Open the `.env` file and replace the placeholder with your Neon connection URL:

```env
DATABASE_URL='postgresql://neondb_owner:your_password@your-host.neon.tech/neondb?sslmode=require&channel_binding=require'
```

**Important:** Make sure `.env` is listed in your `.gitignore` file.

## Step 5: Define Your Database Schema

Open `prisma/schema.prisma` and ensure the generator section looks like this (remove any custom output path):

```prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
```

Add your data models:

```prisma
model User {
  id    Int     @id @default(autoincrement())
  email String  @unique
  name  String?
  posts Post[]
}

model Post {
  id        Int     @id @default(autoincrement())
  title     String
  content   String?
  published Boolean @default(false)
  authorId  Int
  author    User    @relation(fields: [authorId], references: [id])
}
```

## Step 6: Create and Apply Database Migration

Run the migration command to create tables in your Neon database:

```bash
npx prisma migrate dev
```

When prompted, enter a name for the migration (e.g., "init"):

```
✔ Enter a name for the new migration: ... init
Applying migration `20251014082759_init`
```

**What happens during migration:**
1. Syncs your Neon database with the schema
2. Creates a migration file in `prisma/migrations/`
3. Generates the Prisma Client

**Expected output:**
```
The following migration(s) have been created and applied from new schema changes:

prisma\migrations/
  └─ 20251014082759_init/
    └─ migration.sql

Your database is now in sync with your schema.

✔ Generated Prisma Client (v6.17.1) to .\node_modules\.prisma\client in 136ms
```

## Step 7: Set Up Database Seeding

### 7.1 Create the Seed File

Create a file at `prisma/seed.js`:

```javascript
import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

const userData = [
    {
        name: "Alice",
        email: "alice@prisma.io",
        posts: {
            create: [
                {
                    title: "Join the Prisma Discord",
                    content: "https://pris.ly/discord",
                    published: true
                },
                {
                    title: "Prisma on YouTube",
                    content: "https://pris.ly/youtube"
                }
            ]
        }
    },
    {
        name: "Bob",
        email: "bob@prisma.io",
        posts: {
            create: [
                {
                    title: "Follow Prisma on Twitter",
                    content: "https://www.twitter.com/prisma",
                    published: true
                }
            ]
        }
    }
]

export async function main() {
    console.log('Start seeding...')
    for (const u of userData) {
        const user = await prisma.user.create({ data: u })
        console.log(`Created user with id: ${user.id}`)
    }
    console.log('Seeding finished.')
}

main()
    .catch((e) => {
        console.error(e)
        process.exit(1)
    })
    .finally(async () => {
        await prisma.$disconnect()
    })
```

### 7.2 Configure package.json

Add the following configurations to your `package.json`:

```json
{
  "type": "module",
  "prisma": {
    "seed": "node prisma/seed.js"
  },
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start"
  },
  "dependencies": {
    "@prisma/client": "^6.17.1"
  },
  "devDependencies": {
    "prisma": "^6.17.1"
  }
}
```

**Key configurations:**
- `"type": "module"` - Enables ES module syntax (required for `import` statements)
- `"prisma.seed"` - Defines the command to run when seeding the database

## Step 8: Run the Seed Command

Execute the seed script:

```bash
npx prisma db seed
```

**Expected output:**
```
Environment variables loaded from .env
Running seed command `node prisma/seed.js` ...
Start seeding...
Created user with id: 1
Created user with id: 2
Seeding finished.

🌱  The seed command has been executed.
```

## Step 9: Verify Your Data

You can verify the seeded data using Prisma Studio:

```bash
npx prisma studio
```

This opens a browser-based GUI where you can view and edit your database records.

## Common Issues and Solutions

### Issue 1: "jsx is not recognized"

**Error:**
```
'jsx' is not recognized as an internal or external command
```

**Solution:** Change the seed command in `package.json` from `"jsx prisma/seed.js"` to `"node prisma/seed.js"`

### Issue 2: "Directory import is not supported"

**Error:**
```
Error [ERR_UNSUPPORTED_DIR_IMPORT]: Directory import '...\prisma\src\generated\prisma' is not supported
```

**Solution:**
1. Remove any custom `output` path from your `prisma/schema.prisma` generator
2. Change the import in `seed.js` from `"./src/generated/prisma"` to `"@prisma/client"`
3. Run `npx prisma generate`

### Issue 3: "@prisma/client did not initialize"

**Error:**
```
@prisma/client did not initialize yet. Please run "prisma generate"
```

**Solution:**
1. Add `"type": "module"` to your `package.json`
2. Ensure your schema.prisma has no custom output path
3. Run `npx prisma generate`
4. Run `npx prisma db seed`

## Using Prisma Client in Your Next.js App

Create a Prisma client instance in your app (e.g., `lib/prisma.js`):

```javascript
import { PrismaClient } from '@prisma/client'

const globalForPrisma = globalThis

export const prisma = globalForPrisma.prisma ?? new PrismaClient()

if (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma
```

Use it in your API routes or server components:

```javascript
import { prisma } from '@/lib/prisma'

export async function getUsers() {
  const users = await prisma.user.findMany({
    include: { posts: true }
  })
  return users
}
```

## Useful Prisma Commands

```bash
# Generate Prisma Client after schema changes
npx prisma generate

# Create and apply a new migration
npx prisma migrate dev

# Apply migrations in production
npx prisma migrate deploy

# Open Prisma Studio (database GUI)
npx prisma studio

# Seed the database
npx prisma db seed

# Reset the database (WARNING: deletes all data)
npx prisma migrate reset
```

## Best Practices

1. **Never commit `.env` files** - Add them to `.gitignore`
2. **Use connection pooling** - Neon provides built-in pooling (notice `-pooler` in the URL)
3. **Singleton Prisma Client** - Use a single instance in development to avoid connection issues
4. **Type safety** - Let TypeScript infer types from your Prisma schema
5. **Migrations** - Always create migrations for schema changes, never edit the database directly

## Resources

- [Prisma Documentation](https://www.prisma.io/docs)
- [Neon Documentation](https://neon.tech/docs)
- [Prisma with Next.js](https://www.prisma.io/docs/guides/other/prisma-with-nextjs)
- [Prisma Schema Reference](https://www.prisma.io/docs/reference/api-reference/prisma-schema-reference)

---

**Congratulations!** 🎉 You now have a fully configured Prisma setup with a Neon PostgreSQL database, complete with migrations and seeded data.